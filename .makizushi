#!/bin/bash

chrootdir='/var/mychroots'

declare -A chroots
chroots=(['stable32']='linux32' ['stable64']='linux64')

packager='Thomas Dziedzic < gostrc at gmail >'
makeflags='-j2'

alias db-aur='ssh aur.archlinux.org /arch/db-update'

mkchr() {
  ${chroots[$1]} sudo makechrootpkg -c -r ${chrootdir}/${1} ${@:2}
}

mkchrs() {
  for k in ${!chroots[@]} ; do
    mkchr ${k} ${@:1}
  done
}

mkdchr() {
  ${chroots[$1]} sudo makechrootpkg -r ${chrootdir}/${1} ${@:2}
}

mkdchrs() {
  for k in ${!chroots[@]} ; do
    mkdchr ${k} ${@:1}
  done
}

upchr() {
  ${chroots[$1]} sudo mkarchroot -u ${chrootdir}/${1}/root ${@:1}
}

upchrs() {
  for k in ${!chroots[@]} ; do
    upchr ${k} ${@:1}
  done
}

newchr() {
  sudo mkdir -p ${chrootdir}/${1}
  ${chroots[$1]} sudo mkarchroot "${@:2}" ${chrootdir}/${1}/root base base-devel sudo

  # needed if adding support for [testing]
  #sudo ${EDITOR} ${chrootdir}/${chrootname[$1]}/root/etc/pacman.conf

  sudo sed "s/#PACKAGER=.*/PACKAGER='${packager}'/" -i ${chrootdir}/${1}/root/etc/makepkg.conf
  sudo sed "s/#MAKEFLAGS=.*/MAKEFLAGS='${makeflags}'/" -i ${chrootdir}/${1}/root/etc/makepkg.conf
}

newchrs() {
  sudo rm -rf ${chrootdir}

  for k in ${!chroots[@]} ; do
    newchr ${k} ${@:1}
  done
}
